---- Base app schema

-- User
CREATE TABLE "user" (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000) PRIMARY KEY,
  username VARCHAR(128) NOT NULL UNIQUE,
  
  -- auth
  pwd VARCHAR(256),
  pwd_salt UUID NOT NULL DEFAULT gen_random_uuid(),
  token_salt UUID NOT NULL DEFAULT gen_random_uuid(),

  -- Timestamps
  cid BIGINT NOT NULL,
  ctime TIMESTAMP WITH TIME ZONE NOT NULL,
  mid BIGINT NOT NULL,
  mtime TIMESTAMP WITH TIME ZONE NOT NULL  
);

-- Project
CREATE TABLE project (
  -- PK
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000) PRIMARY KEY,

  -- Properties
  owner_id BIGINT NOT NULL,
  name varchar(256) NOT NULL,

  -- Timestamps
  cid BIGINT NOT NULL,
  ctime TIMESTAMP WITH TIME ZONE NOT NULL,
  mid BIGINT NOT NULL,
  mtime TIMESTAMP WITH TIME ZONE NOT NULL  
);

-- Task
CREATE TABLE "task" (
  -- PK
  id BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1000) PRIMARY KEY,

  -- FK
  project_id BIGINT NOT NULL,

  -- Properties
  title VARCHAR(256) NOT NULL,
  done BOOL NOT NULL DEFAULT FALSE,

  -- Timestamps
  cid BIGINT NOT NULL,
  ctime TIMESTAMP WITH TIME ZONE NOT NULL,
  mid BIGINT NOT NULL,
  mtime TIMESTAMP WITH TIME ZONE NOT NULL  
);

ALTER TABLE task ADD CONSTRAINT fk_project FOREIGN KEY (project_id) REFERENCES project(id) ON DELETE CASCADE;